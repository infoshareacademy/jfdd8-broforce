<html><body><head><style>
    body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
    }

    .table {
        display: flex;
        width: 500px;
        height: 500px;
        align-items: stretch;
        flex-direction: column;
    }

    .table > div {
        display: flex;
        flex-grow: 1;
    }

    .table > div > div {
        flex-grow: 1;
        border: 1px solid black;
    }

    .egg {
        background: #0c0;
        border-radius: 50px;
    }

    .basket {
        background: #c00;
    }
    .wall {
        background: black;
    }
</style>
</head>

<div id="score">0</div>
<div id="app"></div>
<button id="start-game">Start</button>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
    $(document).ready(function () {
        var size = 11;
        var score = 0;
        var gameIntervalId;
//        var eggsIntervalId;
        var $app = $('#app');
        var $board = createBoard();
        $app.append($board);
        var $walls = createWalls();
        $app.append($walls);



        $('#start-game').click(play);

        function range(size) {
            return Array.from({ length: size })
        }

        function createBoard() {
            return $('<div>').addClass('table').append(
                range(size).map(function () {
                    return $('<div>').append(range(size).map(function () {
                        return $('<div>')
                    }))
                })
            );
        }

        function createWalls() {
            return $('<div>').addClass('wall')
        }

        function drawEggStartingPosition() {
            return $('.table div:first div').eq(
                Math.floor(Math.random() * size)
            )
        }

        function createBasket($node) {
            $node.addClass('basket')
        }

        function createEgg($node) {
            $node.addClass('egg')
        }

        function moveEggs() {
            $('.egg').each(function () {
                var $currentNode = $(this);
                var $targetNode = $currentNode.parent().next().find('div').eq($currentNode.index())

                if ($targetNode.length === 0) {
                    updateScore(-1)
                }
                $currentNode.removeClass('egg');
                $targetNode.addClass('egg');

            })
        }

        function moveBasketRight() {
            var $currentNode = $('.basket');
            var $targetNode = $currentNode.next();

            if ($targetNode.length === 0) {
                // skip
            } else {
                $currentNode.removeClass('basket');
                $targetNode.addClass('basket');
            }
        }

        function moveBasketLeft() {
            var $currentNode = $('.basket');
            var $targetNode = $currentNode.prev();

            if ($targetNode.length === 0) {
                // skip
            } else {
                $currentNode.removeClass('basket');
                $targetNode.addClass('basket');
            }
        }

        function moveBasketUp() {
            var $currentNode = $('.basket');
            var $targetNode = $currentNode.prev();

            if ($targetNode.length === 0) {
                // skip
            } else {
                $currentNode.removeClass('basket');
                $targetNode.addClass('basket');
            }
        }

        function detectCatch() {
            var $catchNode = $('.basket.egg');
            if ($catchNode.length > 0) {
                // console.log('CATCHED!')
                updateScore(1);
                $catchNode.removeClass('egg');
            }
        }

        function updateScore(delta) {
            score += delta;
            $('#score').text(score);
        }

        function play() {
            score = 0;
            updateScore(0);
            $('.egg, .basket').removeClass('egg basket');
            var $basketPosition = $('.table > div:last > div').eq(4);
            createBasket($basketPosition);

            $(window).off('keyup');
            $(window).on('keyup', function (event) {
                // console.log(event.keyCode);
                switch (event.keyCode) {
                    case 39:
                        moveBasketRight();
                        break;

                    case 37:
                        moveBasketLeft();
                        break;
                    case 38:
                        moveBasketUp();
                        break;

                    case 34:
                        moveBasketDown();
                        break;
                }
                detectCatch()
            });

            clearInterval(gameIntervalId);
            gameIntervalId = setInterval(function () {
                moveEggs();
                detectCatch();
            }, 500);

            clearInterval(eggsIntervalId);
            eggsIntervalId = setInterval(function () {
                var $eggPosition = drawEggStartingPosition();
                createEgg($eggPosition);
            }, 500);
        }
    })
</script>
</body>
</html>

